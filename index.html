<!DOCTYPE html>
<html>
<head>
    <title>Enhanced Network Visualization</title>
    <style>
        body { 
            margin: 0; 
            background: #ffffff;
        }
        canvas { 
            width: 100vw; 
            height: 100vh; 
        }
        .tooltip {
            position: absolute;
            padding: 10px;
            background: rgba(0, 0, 0, 0.8);
            color: #fff;
            font-family: Arial, sans-serif;
            font-size: 12px;
            border-radius: 5px;
            pointer-events: none;
            z-index: 10;
            display: none;
        }
    </style>
    <script src="//unpkg.com/3d-force-graph"></script>
    <script src="//cdnjs.cloudflare.com/ajax/libs/three.js/110/three.min.js"></script>
    <script src="//threejs.org/examples/js/postprocessing/EffectComposer.js"></script>
    <script src="//threejs.org/examples/js/postprocessing/RenderPass.js"></script>
    <script src="//threejs.org/examples/js/postprocessing/UnrealBloomPass.js"></script>
</head>
<body>
    <div id="3d-graph"></div>
    <div id="tooltip" class="tooltip"></div>

    <script>
        fetch('./network_data.json')
            .then(res => res.json())
            .then(data => {
                const tooltip = document.getElementById('tooltip');
                const Graph = ForceGraph3D()
                    (document.getElementById('3d-graph'))
                    .graphData(data)
                    .linkColor(() => 'rgba(0,0,0,1)') // Black links
                    .linkWidth(1)
                    .linkDirectionalArrowLength(0)
                    .nodeColor(node => node.highlighted ? '#ff0000' : 'rgba(0,0,0,1)')
                    .nodeRelSize(0.5)
                    .backgroundColor('#ffffff')
                    .onNodeHover(node => {
                        if (node) {
                            node.highlighted = true;
                            tooltip.style.left = `${event.clientX + 5}px`;
                            tooltip.style.top = `${event.clientY + 5}px`;
                            tooltip.style.display = 'block';
                            tooltip.innerHTML = `
                                <strong>ID:</strong> ${node.id}<br>
                                <strong>Type:</strong> ${node.type}<br>
                                <strong>Value:</strong> ${node.value || 'N/A'}
                            `;
                        } else {
                            tooltip.style.display = 'none';
                            data.nodes.forEach(n => n.highlighted = false);
                        }
                        Graph.nodeColor(Graph.nodeColor()); // Refresh colors
                    })
                    .onNodeClick(node => {
                        // Center camera on the clicked node
                        const distance = 40;
                        const distRatio = 1 + distance / Math.hypot(node.x, node.y, node.z);
                        Graph.cameraPosition(
                            { x: node.x * distRatio, y: node.y * distRatio, z: node.z * distRatio },
                            node,
                            2000
                        );
                    });

                // Add bloom effect
                const bloomPass = new THREE.UnrealBloomPass(
                    new THREE.Vector2(window.innerWidth, window.innerHeight),
                    1.5, // Strength
                    0.4, // Radius
                    0.85 // Threshold
                );
                Graph.postProcessingComposer().addPass(bloomPass);

                // Mouse movement for tooltip tracking
                document.addEventListener('mousemove', event => {
                    tooltip.style.left = `${event.clientX + 5}px`;
                    tooltip.style.top = `${event.clientY + 5}px`;
                });
            });
    </script>
</body>
</html>
