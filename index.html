import React, { useEffect, useRef } from 'react';
import ForceGraph3D from '3d-force-graph';

const NetworkVisualization = () => {
  const containerRef = useRef();
  
  useEffect(() => {
    // Initialize data from network_data.json
    const { nodes, links } = window.network_data;
    
    // List of nodes to highlight in red
    const highlightNodes = [
      'currentglobalnews.site',
      '276 Tiffin St, Barrie, ON, L4N-2N4, CA',
      'Amsterdam, North Holland, NH, The Netherlands, NL',
      'beget.com'
    ];

    const gData = {
      nodes: nodes.map(node => ({
        ...node,
        color: highlightNodes.includes(node.id) ? '#FF0000' : '#808080'
      })),
      links
    };

    // Create the force graph
    const Graph = ForceGraph3D()(containerRef.current)
      .graphData(gData)
      .linkColor(() => '#999999')
      .linkWidth(1)
      .linkDirectionalArrowLength(3.5)
      .nodeRelSize(6)
      .nodeOpacity(1)
      .linkOpacity(0.4)
      .backgroundColor('#FFFFFF')
      .showNavInfo(false);

    // Set initial camera position for better view
    Graph.cameraPosition({ x: 1000, y: 1000, z: 1000 });

    // Add hover effects
    Graph
      .onNodeHover(node => {
        if (node) {
          containerRef.current.style.cursor = 'pointer';
        } else {
          containerRef.current.style.cursor = 'default';
        }
      })
      .onNodeClick(node => {
        if (node) {
          // Look at the clicked node
          const distance = 300;
          const distRatio = 1 + distance/Math.hypot(node.x, node.y, node.z);
          Graph.cameraPosition(
            { x: node.x * distRatio, y: node.y * distRatio, z: node.z * distRatio },
            node,
            1000
          );
        }
      });

    // Cleanup on unmount
    return () => Graph._destructor();
  }, []);

  return (
    <div className="w-full h-screen" ref={containerRef}></div>
  );
};

export default NetworkVisualization;
