<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Network Visualization</title>
    <style>
        body {
            margin: 0;
            background: #ffffff;
        }
        canvas {
            width: 100vw;
            height: 100vh;
        }
    </style>
    <!-- Include D3.js -->
    <script src="https://d3js.org/d3.v6.min.js"></script>
    <!-- Include 3D Force Graph -->
    <script src="https://unpkg.com/3d-force-graph"></script>
</head>
<body>
    <div id="3d-graph"></div>

    <script>
        document.addEventListener('DOMContentLoaded', function () {
            const highlightNodes = [
                "currentglobalnews.site",
                "276 Tiffin St, Barrie, ON, L4N-2N4, CA",
                "Amsterdam, North Holland, NH, The Netherlands, NL",
                "beget.com"
            ];

            // Fetch network data and initialize the graph
            fetch('./network_data.json')
                .then(res => res.json())
                .then(data => {
                    // Make sure each node has x, y, z properties, otherwise set default values
                    data.nodes.forEach(node => {
                        if (node.x === undefined || isNaN(node.x)) node.x = Math.random() * 500 - 250; // Set random position if not available or NaN
                        if (node.y === undefined || isNaN(node.y)) node.y = Math.random() * 500 - 250;
                        if (node.z === undefined || isNaN(node.z)) node.z = Math.random() * 500 - 250;
                    });

                    const graph = ForceGraph3D()
                        (document.getElementById('3d-graph'))
                        .graphData(data)
                        .linkColor(() => 'rgba(0,0,0,1)')
                        .linkWidth(1)
                        .linkDirectionalArrowLength(0)
                        .backgroundColor('#ffffff')
                        .nodeColor(node => highlightNodes.includes(node.id) ? 'red' : 'black')
                        .nodeRelSize(node => highlightNodes.includes(node.id) ? 10 : 5) // Larger size for highlighted nodes
                        .nodeLabel(node => node.id) // Display node ID as label on hover
                        .showNavInfo(false)
                        .d3Force('charge', d3.forceManyBody().strength(-100))
                        .d3Force('link', d3.forceLink().distance(100));

                    // Optional: Log node positions to ensure they have valid values
                    console.log("Node positions:", data.nodes);
                })
                .catch(error => {
                    console.error("Error loading the network data:", error);
                });
        });
    </script>
</body>
</html>
